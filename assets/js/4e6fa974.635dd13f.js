"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[557],{36848:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>t,toc:()=>l});var a=i(74848),r=i(28453);const o={title:"Domain Manager configuration for Keystone",type:"Standard",status:"Draft",track:"IAM"},s=void 0,t={id:"scs-0302-v1-domain-manager-role",title:"Domain Manager configuration for Keystone",description:"Introduction",source:"@site/standards/scs-0302-v1-domain-manager-role.md",sourceDirName:".",slug:"/scs-0302-v1-domain-manager-role",permalink:"/standards/scs-0302-v1-domain-manager-role",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Domain Manager configuration for Keystone",type:"Standard",status:"Draft",track:"IAM"},sidebar:"standards",previous:{title:"scs-0302: Domain Manager configuration for Keystone",permalink:"/standards/iam/scs-0302"},next:{title:"Ops Standards",permalink:"/standards/ops/"}},d={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Glossary",id:"glossary",level:3},{value:"Impact",id:"impact",level:3},{value:"Motivation",id:"motivation",level:2},{value:"Desired Workflow",id:"desired-workflow",level:3},{value:"Design Considerations",id:"design-considerations",level:2},{value:"Options considered",id:"options-considered",level:3},{value:"Re-using the existing <code>admin</code> role",id:"re-using-the-existing-admin-role",level:4},{value:"Introducing a new persona and role with API policy changes",id:"introducing-a-new-persona-and-role-with-api-policy-changes",level:4},{value:"Open questions",id:"open-questions",level:2},{value:"Limitations",id:"limitations",level:3},{value:"Decision",id:"decision",level:2},{value:"Policy adjustments",id:"policy-adjustments",level:3},{value:"Specifying manageable roles via &quot;<code>is_domain_managed_role</code>&quot;",id:"specifying-manageable-roles-via-is_domain_managed_role",level:4},{value:"Example: permitting multiple roles",id:"example-permitting-multiple-roles",level:5},{value:"Related Documents",id:"related-documents",level:2},{value:"&quot;admin&quot;-ness not properly scoped",id:"admin-ness-not-properly-scoped",level:3},{value:"Consistent and Secure Default RBAC",id:"consistent-and-secure-default-rbac",level:3},{value:"Conformance Tests",id:"conformance-tests",level:2},{value:"Appendix",id:"appendix",level:2},{value:"Decision Record",id:"decision-record",level:3},{value:"Change the naming of the Domain Manager role to align with upstream",id:"change-the-naming-of-the-domain-manager-role-to-align-with-upstream",level:4},{value:"Allow flexibility for the roles a Domain Manager can assign/revoke within domain",id:"allow-flexibility-for-the-roles-a-domain-manager-can-assignrevoke-within-domain",level:4},{value:"Extend domain management functionality to Keystone groups",id:"extend-domain-management-functionality-to-keystone-groups",level:4},{value:"Change the naming of the Domain Manager role",id:"change-the-naming-of-the-domain-manager-role",level:4}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsxs)(n.p,{children:["SCS Clouds should provide a way to grant Domain Manager rights to SCS Customers which provides IAM self-service capabilities within an OpenStack domain.\nThis is not properly implemented in the default OpenStack configuration and requires specific adjustments to the Keystone identity management configuration.\nTo avoid conflict with the unscoped ",(0,a.jsx)(n.code,{children:"admin"}),' role in OpenStack we want to refer to this new persona as "Domain Manager", introducing the ',(0,a.jsx)(n.code,{children:"manager"})," role in the API for domains."]}),"\n",(0,a.jsx)(n.h3,{id:"glossary",children:"Glossary"}),"\n",(0,a.jsx)(n.p,{children:"The following special terms are used throughout this standard document:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Term"}),(0,a.jsx)(n.th,{children:"Meaning"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"RBAC"}),(0,a.jsxs)(n.td,{children:["Role-Based Access Control",(0,a.jsx)(n.sup,{children:(0,a.jsx)(n.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})," established by OpenStack Keystone"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"project"}),(0,a.jsx)(n.td,{children:"OpenStack project as per Keystone RBAC"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"user"}),(0,a.jsx)(n.td,{children:"OpenStack user as per Keystone RBAC"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"group"}),(0,a.jsx)(n.td,{children:"OpenStack group as per Keystone RBAC"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"role"}),(0,a.jsx)(n.td,{children:"OpenStack role as per Keystone RBAC"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"domain"}),(0,a.jsx)(n.td,{children:"OpenStack domain as per Keystone RBAC"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"IAM"}),(0,a.jsx)(n.td,{children:"identity and access management"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"persona"}),(0,a.jsx)(n.td,{children:"Abstract and conceptual role of a user in terms of IAM"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"IAM resources"}),(0,a.jsx)(n.td,{children:"projects, users, groups, roles, domains as managed by OpenStack Keystone"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"CSP"}),(0,a.jsx)(n.td,{children:"Cloud Service Provider, provider managing the OpenStack infrastructure"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"cloud admin"}),(0,a.jsxs)(n.td,{children:["OpenStack user belonging to the CSP that possesses the ",(0,a.jsx)(n.code,{children:"admin"})," role"]})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"impact",children:"Impact"}),"\n",(0,a.jsx)(n.p,{children:"Applying this standard modifies the API policy configuration of Keystone and introduces a new persona to Keystone to enable IAM self-service for customers within a domain.\nOnce assigned, this persona allows special Domain Manager users within a domain to manage users, project, groups and role assignments as part of the IAM self-service."}),"\n",(0,a.jsx)(n.p,{children:"However, the configuration change introduced by this standard does not automatically assign the Domain Manager persona to any users per default.\nAssigning the new persona and granting customers the resulting self-service capabilities is a deliberate action to be taken by the CSP on a per-tenant (i.e. per domain) basis."}),"\n",(0,a.jsx)(n.p,{children:"Omitting the provisioning of any Domain Manager users (i.e. not assigning the new persona to any user) will result in an OpenStack cloud that behaves identically to a configuration without the standard applied, making the actual usage of the functionality a CSP's choice and entirely optional."}),"\n",(0,a.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,a.jsxs)(n.p,{children:["In the default configuration of Keystone, only users with the ",(0,a.jsx)(n.code,{children:"admin"})," role may manage the IAM resources such as projects, groups and users and their relation through role assignments.\nThe ",(0,a.jsx)(n.code,{children:"admin"})," role in OpenStack Keystone is not properly scoped when assigned within a domain or project only as due to hard-coded architectural limitations in OpenStack, a user with the ",(0,a.jsx)(n.code,{children:"admin"})," role may escalate their privileges outside their assigned project or domain boundaries.\nThus, it is not possible to properly give customers a self-service functionality in regard to project, group and user management with the default configuration."]}),"\n",(0,a.jsxs)(n.p,{children:["To address this, this standard defines a new Domain Manager persona implemented using a domain-scoped ",(0,a.jsx)(n.code,{children:"manager"})," role in conjunction with appropriate Keystone API policy adjustments to establish a standardized extension to the default Keystone configuration allowing for IAM self-service capabilities for customers within domains."]}),"\n",(0,a.jsx)(n.h3,{id:"desired-workflow",children:"Desired Workflow"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"The cloud admin deploys the Domain Manager policy configuration for Keystone as per this standard if it is not already applied."}),"\n",(0,a.jsx)(n.li,{children:"The cloud admin creates the desired domains for the customers for which IAM self-service capabilities are desired."}),"\n",(0,a.jsxs)(n.li,{children:["The cloud admin creates one or more users within each of the applicable domains and assigns the ",(0,a.jsx)(n.code,{children:"manager"})," role for a certain domain to them. These users represent the Domain Managers of the corresponding domain."]}),"\n",(0,a.jsx)(n.li,{children:"The customer uses the Domain Manager users to manage (create, update, delete) users, projects, groups and corresponding role assignments within their domain."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"design-considerations",children:"Design Considerations"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"the Domain Manager persona MUST support managing projects, groups and users within a specific domain"}),"\n",(0,a.jsx)(n.li,{children:"the Domain Manager persona MUST be properly scoped to a domain, it MUST NOT gain access to resources outside its owning domain"}),"\n",(0,a.jsx)(n.li,{children:"the Domain Manager persona MUST NOT be able to manipulate existing roles or create new roles"}),"\n",(0,a.jsx)(n.li,{children:"the Domain Manager persona MUST only be able to assign specific non-administrative* roles to their managed users where the applicable roles are defined by the CSP"}),"\n",(0,a.jsx)(n.li,{children:"Domain Managers MUST NOT be able to abuse the role assignment functionalities to escalate their own privileges or those of other users beyond the roles defined by the CSP"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:['* "non-administrative" in this context means this excludes the role "',(0,a.jsx)(n.code,{children:"admin"}),'" and any comparable role that grants permissions beyond domain and tenant scope.\nSince the "',(0,a.jsx)(n.code,{children:"manager"}),'" role as defined in this standard is domain-scoped for a Domain Manager, it does not count as administrative.']}),"\n",(0,a.jsx)(n.h3,{id:"options-considered",children:"Options considered"}),"\n",(0,a.jsxs)(n.h4,{id:"re-using-the-existing-admin-role",children:["Re-using the existing ",(0,a.jsx)(n.code,{children:"admin"})," role"]}),"\n",(0,a.jsxs)(n.p,{children:["As role assignments can be scoped to project, groups and domains the most obvious option would be to assign the existing ",(0,a.jsx)(n.code,{children:"admin"})," role to users representing Domain Managers in a scoped fashion."]}),"\n",(0,a.jsxs)(n.p,{children:["However, due to architectural limitations",(0,a.jsx)(n.sup,{children:(0,a.jsx)(n.a,{href:"#user-content-fn-2",id:"user-content-fnref-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})})," of the existing OpenStack implementation of roles, the ",(0,a.jsx)(n.code,{children:"admin"})," role has a special meaning reaching beyond the RBAC checks done by Keystone and other OpenStack components.\nThis results in special permissions being granted to users possessing the role which ignore the project or domain scope of the role assignment.\nThis poses severe security risks as the proper scoping of the ",(0,a.jsx)(n.code,{children:"admin"})," role is impossible.\n",(0,a.jsx)(n.strong,{children:"Due to this, this approach was discarded early."})]}),"\n",(0,a.jsxs)(n.p,{children:["Upstream (OpenStack) is in the process of addressing this across the services, but it has not been fully implemented yet, especially for domains",(0,a.jsx)(n.sup,{children:(0,a.jsx)(n.a,{href:"#user-content-fn-3",id:"user-content-fnref-3","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})}),"."]}),"\n",(0,a.jsx)(n.h4,{id:"introducing-a-new-persona-and-role-with-api-policy-changes",children:"Introducing a new persona and role with API policy changes"}),"\n",(0,a.jsxs)(n.p,{children:["OpenStack Keystone allows for new roles to be created via its API by administrative users.\nAdditionally, each OpenStack API's RBAC can be adjusted through an API policy file (",(0,a.jsx)(n.code,{children:"policy.yaml"}),") through olso-policy",(0,a.jsx)(n.sup,{children:(0,a.jsx)(n.a,{href:"#user-content-fn-4",id:"user-content-fnref-4","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"4"})}),", Keystone included.\nThe possibility of managing users, projects, role assignments and so on is regulated through Keystone's RBAC configured by its API policy file."]}),"\n",(0,a.jsx)(n.p,{children:"This means that by creating a new role and extending Keystone's API policy configuration a new Domain Manager persona can be established that is limited to a specific subset of the Keystone API to be used to manage users, projects and role assignments within a domain."}),"\n",(0,a.jsx)(n.h2,{id:"open-questions",children:"Open questions"}),"\n",(0,a.jsx)(n.h3,{id:"limitations",children:"Limitations"}),"\n",(0,a.jsx)(n.p,{children:"The approach described in this standard imposes the following limitations:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:['as a result of the "',(0,a.jsx)(n.code,{children:"identity:list_domains"}),'" rule (see below), Domain Managers are able to see all domains',(0,a.jsx)(n.sup,{children:(0,a.jsx)(n.a,{href:"#user-content-fn-5",id:"user-content-fnref-5","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"5"})}),' via "',(0,a.jsx)(n.code,{children:"openstack domain list"}),'" and can inspect the metadata of other domains with "',(0,a.jsx)(n.code,{children:"openstack domain show"}),'"']}),"\n",(0,a.jsxs)(n.li,{children:['as a result of the "',(0,a.jsx)(n.code,{children:"identity:list_roles"}),'" rule (see below), Domain Managers are able to see all roles via "',(0,a.jsx)(n.code,{children:"openstack role list"}),'" and can inspect the metadata of other roles with "',(0,a.jsx)(n.code,{children:"openstack role show"}),'"']}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"As a result of points 1 and 2, metadata of all domains and roles will be exposed to all Domain Managers!"})}),"\n",(0,a.jsxs)(n.p,{children:["If a CSP deems either of these points critical, they may abstain from granting the ",(0,a.jsx)(n.code,{children:'"manager"'})," role to any user in a domain scope, effectively disabling the Domain Manager functionality. See ",(0,a.jsx)(n.a,{href:"#impact",children:"Impact"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,a.jsxs)(n.p,{children:['A role named "',(0,a.jsx)(n.code,{children:"manager"}),'" is to be created via the Keystone API and the policy adjustments quoted below are to be applied.']}),"\n",(0,a.jsx)(n.h3,{id:"policy-adjustments",children:"Policy adjustments"}),"\n",(0,a.jsx)(n.p,{children:"The following policy has to be applied to Keystone in a verbatim fashion.\nThe only parts of the policy definitions that may be changed are:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:['The "',(0,a.jsx)(n.code,{children:"base_*"}),'" definitions to align them to the correct OpenStack defaults matching the OpenStack release of the environment in case those differ from this template.']}),"\n",(0,a.jsxs)(n.li,{children:['The "',(0,a.jsx)(n.code,{children:"is_domain_managed_role"}),'" definition (see next section below).']}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'# SCS Domain Manager policy configuration\n\n# Section A: OpenStack base definitions\n# The entries beginning with "base_<rule>" should be exact copies of the\n# default "identity:<rule>" definitions for the target OpenStack release.\n# They will be extended upon for the manager role below this section.\n"base_get_domain": "(role:reader and system_scope:all) or token.domain.id:%(target.domain.id)s or token.project.domain.id:%(target.domain.id)s"\n"base_list_domains": "(role:reader and system_scope:all)"\n"base_list_roles": "(role:reader and system_scope:all)"\n"base_get_role": "(role:reader and system_scope:all)"\n"base_list_users": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.domain_id)s)"\n"base_get_user": "(role:reader and system_scope:all) or (role:reader and token.domain.id:%(target.user.domain_id)s) or user_id:%(target.user.id)s"\n"base_create_user": "(role:admin and system_scope:all) or (role:admin and token.domain.id:%(target.user.domain_id)s)"\n"base_update_user": "(role:admin and system_scope:all) or (role:admin and token.domain.id:%(target.user.domain_id)s)"\n"base_delete_user": "(role:admin and system_scope:all) or (role:admin and token.domain.id:%(target.user.domain_id)s)"\n"base_list_projects": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.domain_id)s)"\n"base_get_project": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.project.domain_id)s) or project_id:%(target.project.id)s"\n"base_create_project": "(role:admin and system_scope:all) or (role:admin and domain_id:%(target.project.domain_id)s)"\n"base_update_project": "(role:admin and system_scope:all) or (role:admin and domain_id:%(target.project.domain_id)s)"\n"base_delete_project": "(role:admin and system_scope:all) or (role:admin and domain_id:%(target.project.domain_id)s)"\n"base_list_user_projects": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.user.domain_id)s) or user_id:%(target.user.id)s"\n"base_check_grant": "(role:reader and system_scope:all) or ((role:reader and domain_id:%(target.user.domain_id)s and domain_id:%(target.project.domain_id)s) or (role:reader and domain_id:%(target.user.domain_id)s and domain_id:%(target.domain.id)s) or (role:reader and domain_id:%(target.group.domain_id)s and domain_id:%(target.project.domain_id)s) or (role:reader and domain_id:%(target.group.domain_id)s and domain_id:%(target.domain.id)s)) and (domain_id:%(target.role.domain_id)s or None:%(target.role.domain_id)s)"\n"base_list_grants": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.user.domain_id)s and domain_id:%(target.project.domain_id)s) or (role:reader and domain_id:%(target.user.domain_id)s and domain_id:%(target.domain.id)s) or (role:reader and domain_id:%(target.group.domain_id)s and domain_id:%(target.project.domain_id)s) or (role:reader and domain_id:%(target.group.domain_id)s and domain_id:%(target.domain.id)s)"\n"base_create_grant": "(role:admin and system_scope:all) or ((role:admin and domain_id:%(target.user.domain_id)s and domain_id:%(target.project.domain_id)s) or (role:admin and domain_id:%(target.user.domain_id)s and domain_id:%(target.domain.id)s) or (role:admin and domain_id:%(target.group.domain_id)s and domain_id:%(target.project.domain_id)s) or (role:admin and domain_id:%(target.group.domain_id)s and domain_id:%(target.domain.id)s)) and (domain_id:%(target.role.domain_id)s or None:%(target.role.domain_id)s)"\n"base_revoke_grant": "(role:admin and system_scope:all) or ((role:admin and domain_id:%(target.user.domain_id)s and domain_id:%(target.project.domain_id)s) or (role:admin and domain_id:%(target.user.domain_id)s and domain_id:%(target.domain.id)s) or (role:admin and domain_id:%(target.group.domain_id)s and domain_id:%(target.project.domain_id)s) or (role:admin and domain_id:%(target.group.domain_id)s and domain_id:%(target.domain.id)s)) and (domain_id:%(target.role.domain_id)s or None:%(target.role.domain_id)s)"\n"base_list_role_assignments": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.domain_id)s)"\n"base_list_groups": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.group.domain_id)s)"\n"base_get_group": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.group.domain_id)s)"\n"base_create_group": "(role:admin and system_scope:all) or (role:admin and domain_id:%(target.group.domain_id)s)"\n"base_update_group": "(role:admin and system_scope:all) or (role:admin and domain_id:%(target.group.domain_id)s)"\n"base_delete_group": "(role:admin and system_scope:all) or (role:admin and domain_id:%(target.group.domain_id)s)"\n"base_list_groups_for_user": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.user.domain_id)s) or user_id:%(user_id)s"\n"base_list_users_in_group": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.group.domain_id)s)"\n"base_remove_user_from_group": "(role:admin and system_scope:all) or (role:admin and domain_id:%(target.group.domain_id)s and domain_id:%(target.user.domain_id)s)"\n"base_check_user_in_group": "(role:reader and system_scope:all) or (role:reader and domain_id:%(target.group.domain_id)s and domain_id:%(target.user.domain_id)s)"\n"base_add_user_to_group": "(role:admin and system_scope:all) or (role:admin and domain_id:%(target.group.domain_id)s and domain_id:%(target.user.domain_id)s)"\n\n# Section B: Domain Manager Extensions\n\n# classify domain managers with a special role\n"is_domain_manager": "role:manager"\n\n# specify a rule that whitelists roles which domain admins are permitted\n# to assign and revoke within their domain\n"is_domain_managed_role": "\'member\':%(target.role.name)s or \'load-balancer_member\':%(target.role.name)s"\n\n# allow domain admins to retrieve their own domain (does not need changes)\n"identity:get_domain": "rule:base_get_domain or rule:admin_required"\n\n# list_domains is needed for GET /v3/domains?name=... requests\n# this is mandatory for things like\n# `create user --domain $DOMAIN_NAME $USER_NAME` to correctly discover\n# domains by name\n"identity:list_domains": "rule:is_domain_manager or rule:base_list_domains or rule:admin_required"\n\n# list_roles is needed for GET /v3/roles?name=... requests\n# this is mandatory for things like `role add ... $ROLE_NAME`` to correctly\n# discover roles by name\n"identity:list_roles": "rule:is_domain_manager or rule:base_list_roles or rule:admin_required"\n\n# get_role is needed for GET /v3/roles/{role_id} requests\n# this is mandatory for the OpenStack SDK to properly process role assignments\n# which are issued by role id instead of name\n"identity:get_role": "(rule:is_domain_manager and rule:is_domain_managed_role) or rule:base_get_role or rule:admin_required"\n\n# allow domain admins to manage users within their domain\n"identity:list_users": "(rule:is_domain_manager and token.domain.id:%(target.domain_id)s) or rule:base_list_users or rule:admin_required"\n"identity:get_user": "(rule:is_domain_manager and token.domain.id:%(target.user.domain_id)s) or rule:base_get_user or rule:admin_required"\n"identity:create_user": "(rule:is_domain_manager and token.domain.id:%(target.user.domain_id)s) or rule:base_create_user or rule:admin_required"\n"identity:update_user": "(rule:is_domain_manager and token.domain.id:%(target.user.domain_id)s) or rule:base_update_user or rule:admin_required"\n"identity:delete_user": "(rule:is_domain_manager and token.domain.id:%(target.user.domain_id)s) or rule:base_delete_user or rule:admin_required"\n\n# allow domain admins to manage projects within their domain\n"identity:list_projects": "(rule:is_domain_manager and token.domain.id:%(target.domain_id)s) or rule:base_list_projects or rule:admin_required"\n"identity:get_project": "(rule:is_domain_manager and token.domain.id:%(target.project.domain_id)s) or rule:base_get_project or rule:admin_required"\n"identity:create_project": "(rule:is_domain_manager and token.domain.id:%(target.project.domain_id)s) or rule:base_create_project or rule:admin_required"\n"identity:update_project": "(rule:is_domain_manager and token.domain.id:%(target.project.domain_id)s) or rule:base_update_project or rule:admin_required"\n"identity:delete_project": "(rule:is_domain_manager and token.domain.id:%(target.project.domain_id)s) or rule:base_delete_project or rule:admin_required"\n"identity:list_user_projects": "(rule:is_domain_manager and token.domain.id:%(target.user.domain_id)s) or rule:base_list_user_projects or rule:admin_required"\n\n# allow domain managers to manage role assignments within their domain\n# (restricted to specific roles by the \'is_domain_managed_role\' rule)\n#\n# project-level role assignment to user within domain\n"is_domain_user_project_grant": "token.domain.id:%(target.user.domain_id)s and token.domain.id:%(target.project.domain_id)s"\n# project-level role assignment to group within domain\n"is_domain_group_project_grant": "token.domain.id:%(target.group.domain_id)s and token.domain.id:%(target.project.domain_id)s"\n# domain-level role assignment to group\n"is_domain_level_group_grant": "token.domain.id:%(target.group.domain_id)s and token.domain.id:%(target.domain.id)s"\n# domain-level role assignment to user\n"is_domain_level_user_grant": "token.domain.id:%(target.user.domain_id)s and token.domain.id:%(target.domain.id)s"\n"domain_manager_grant": "rule:is_domain_manager and (rule:is_domain_user_project_grant or rule:is_domain_group_project_grant or rule:is_domain_level_group_grant or rule:is_domain_level_user_grant)"\n"identity:check_grant": "rule:domain_manager_grant or rule:base_check_grant or rule:admin_required"\n"identity:list_grants": "rule:domain_manager_grant or rule:base_list_grants or rule:admin_required"\n"identity:create_grant": "(rule:domain_manager_grant and rule:is_domain_managed_role) or rule:base_create_grant or rule:admin_required"\n"identity:revoke_grant": "(rule:domain_manager_grant and rule:is_domain_managed_role) or rule:base_revoke_grant or rule:admin_required"\n"identity:list_role_assignments": "(rule:is_domain_manager and token.domain.id:%(target.domain_id)s) or rule:base_list_role_assignments or rule:admin_required"\n\n\n# allow domain managers to manage groups within their domain\n"identity:list_groups": "(rule:is_domain_manager and token.domain.id:%(target.group.domain_id)s) or (role:reader and system_scope:all) or rule:base_list_groups or rule:admin_required"\n"identity:get_group": "(rule:is_domain_manager and token.domain.id:%(target.group.domain_id)s) or (role:reader and system_scope:all) or rule:base_get_group or rule:admin_required"\n"identity:create_group": "(rule:is_domain_manager and token.domain.id:%(target.group.domain_id)s) or rule:base_create_group or rule:admin_required"\n"identity:update_group": "(rule:is_domain_manager and token.domain.id:%(target.group.domain_id)s) or rule:base_update_group or rule:admin_required"\n"identity:delete_group": "(rule:is_domain_manager and token.domain.id:%(target.group.domain_id)s) or rule:base_delete_group or rule:admin_required"\n"identity:list_groups_for_user": "(rule:is_domain_manager and token.domain.id:%(target.user.domain_id)s) or rule:base_list_groups_for_user or rule:admin_required"\n"identity:list_users_in_group": "(rule:is_domain_manager and token.domain.id:%(target.group.domain_id)s) or rule:base_list_users_in_group or rule:admin_required"\n"identity:remove_user_from_group": "(rule:is_domain_manager and token.domain.id:%(target.group.domain_id)s and token.domain.id:%(target.user.domain_id)s) or rule:base_remove_user_from_group or rule:admin_required"\n"identity:check_user_in_group": "(rule:is_domain_manager and token.domain.id:%(target.group.domain_id)s and token.domain.id:%(target.user.domain_id)s) or rule:base_check_user_in_group or rule:admin_required"\n"identity:add_user_to_group": "(rule:is_domain_manager and token.domain.id:%(target.group.domain_id)s and token.domain.id:%(target.user.domain_id)s) or rule:base_add_user_to_group or rule:admin_required"\n'})}),"\n",(0,a.jsxs)(n.p,{children:['Note that the policy file begins with a list of "',(0,a.jsx)(n.code,{children:"base_*"}),'" rule definitions ("Section A").\nThese mirror the default policies of recent OpenStack releases.\nThey are used as a basis for the domain-manager-specific changes which are implemented in "Section B" where they are referenced to via "',(0,a.jsx)(n.code,{children:"or rule:base_*"}),'" accordingly.\nThe section of "',(0,a.jsx)(n.code,{children:"base_*"}),'" rules is meant for easy maintenance/update of default rules while keeping the domain-manager-specific rules separate.']}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"}),'\nThe "',(0,a.jsx)(n.code,{children:"or rule:admin_required"}),'" appendix to the rule definitions in "Section B" is included for backwards compatibility with environments not yet fully configured for the new secure RBAC standard',(0,a.jsx)(n.sup,{children:(0,a.jsx)(n.a,{href:"#user-content-fn-6",id:"user-content-fnref-6","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"6"})}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.h4,{id:"specifying-manageable-roles-via-is_domain_managed_role",children:['Specifying manageable roles via "',(0,a.jsx)(n.code,{children:"is_domain_managed_role"}),'"']}),"\n",(0,a.jsxs)(n.p,{children:['The "',(0,a.jsx)(n.code,{children:"is_domain_managed_role"}),'" rule of the above policy template may be adjusted according to the requirements of the CSP and infrastructure architecture to specify different or multiple roles as manageable by Domain Managers as long as the policy rule adheres to the following:']}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:['the "',(0,a.jsx)(n.code,{children:"is_domain_managed_role"}),'" rule MUST NOT contain the "',(0,a.jsx)(n.code,{children:"admin"}),'" role, neither directly nor transitively']}),"\n",(0,a.jsxs)(n.li,{children:['the "',(0,a.jsx)(n.code,{children:"is_domain_managed_role"}),'" rule MUST define all applicable roles directly, it MUST NOT contain a "',(0,a.jsx)(n.code,{children:"rule:"}),'" reference within itself']}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"example-permitting-multiple-roles",children:"Example: permitting multiple roles"}),"\n",(0,a.jsxs)(n.p,{children:['The following example permits the "',(0,a.jsx)(n.code,{children:"reader"}),'" role to be assigned/revoked by a Domain Manager in addition to the default "',(0,a.jsx)(n.code,{children:"member"}),'" and "',(0,a.jsx)(n.code,{children:"load-balancer_member"}),'" roles.\nFurther roles can be appended using the logical ',(0,a.jsx)(n.code,{children:"or"})," directive."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"\"is_domain_managed_role\": \"'member':%(target.role.name)s or 'load-balancer_member':%(target.role.name)s or 'reader':%(target.role.name)s\"\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["Note regarding the ",(0,a.jsx)(n.code,{children:"manager"})," role"]})}),"\n",(0,a.jsxs)(n.p,{children:['When adjusting the "',(0,a.jsx)(n.code,{children:"is_domain_managed_role"}),'" rule a CSP might opt to also include the "',(0,a.jsx)(n.code,{children:"manager"}),'" role itself in the manageable roles, resulting in Domain Managers being able to propagate the Domain Manager capabilities to other users within their domain.\nThis increases the self-service capabilities of the customer but introduces risks of Domain Managers also being able to revoke this role from themselves or each other (within their domain) in an unintended fashion.']}),"\n",(0,a.jsxs)(n.p,{children:['CSPs have to carefully evaluate whether Domain Manager designation authority should reside solely on their side or be part of the customer self-service scope and decide about adding "',(0,a.jsx)(n.code,{children:"'manager':%(target.role.name)s"}),'" to the rule accordingly.']}),"\n",(0,a.jsx)(n.h2,{id:"related-documents",children:"Related Documents"}),"\n",(0,a.jsx)(n.h3,{id:"admin-ness-not-properly-scoped",children:'"admin"-ness not properly scoped'}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Description:"})," Upstream bug report about the underlying architectural issue of the ",(0,a.jsx)(n.code,{children:"admin"})," role not being properly scoped and giving system-level admin permissions regardless of whether the ",(0,a.jsx)(n.code,{children:"admin"})," role assignment was scoped to project or domain level.\nThis is the main reason for the ",(0,a.jsx)(n.code,{children:"admin"})," role being inappropriate to implement Domain Managers."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Link:"})," ",(0,a.jsx)(n.a,{href:"https://bugs.launchpad.net/keystone/+bug/968696",children:'Launchpad bug: "admin"-ness not properly scoped'})]}),"\n",(0,a.jsx)(n.h3,{id:"consistent-and-secure-default-rbac",children:"Consistent and Secure Default RBAC"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Description:"})," Upstream rework of the default role definitions and hierarchy across all OpenStack services.\nAims to introduce support for a scoped ",(0,a.jsx)(n.code,{children:"manager"})," role by 2024 but only focuses on project-level scoping for this role so far, not domain-level."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Link:"})," ",(0,a.jsx)(n.a,{href:"https://governance.openstack.org/tc/goals/selected/consistent-and-secure-rbac.html",children:"OpenStack Technical Committee Governance Documents: Consistent and Secure Default RBAC"})]}),"\n",(0,a.jsx)(n.h2,{id:"conformance-tests",children:"Conformance Tests"}),"\n",(0,a.jsxs)(n.p,{children:["There is a test suite in ",(0,a.jsx)(n.a,{href:"https://github.com/SovereignCloudStack/standards/blob/main/Tests/iam/domain-manager/domain-manager-check.py",children:(0,a.jsx)(n.code,{children:"domain-manager-check.py"})}),".\nThe test suite connects to the OpenStack API using two sample domains and corresponding Domain Manager accounts.\nIt verifies the compliance to the standard and the proper domain-scoping as defined by the Keystone policy.\nPlease consult the associated ",(0,a.jsx)(n.a,{href:"https://github.com/SovereignCloudStack/standards/blob/main/Tests/iam/domain-manager/README.md",children:"README.md"})," for detailed setup and testing instructions."]}),"\n",(0,a.jsx)(n.h2,{id:"appendix",children:"Appendix"}),"\n",(0,a.jsx)(n.h3,{id:"decision-record",children:"Decision Record"}),"\n",(0,a.jsx)(n.h4,{id:"change-the-naming-of-the-domain-manager-role-to-align-with-upstream",children:"Change the naming of the Domain Manager role to align with upstream"}),"\n",(0,a.jsx)(n.p,{children:"Decision Date: 2024-03-13"}),"\n",(0,a.jsx)(n.p,{children:"Decision Maker: Team IaaS"}),"\n",(0,a.jsx)(n.p,{children:"Decision:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:'the Domain Manager role should be named "manager" not "domain-manager"'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Rationale:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:'upstream (OpenStack) will introduce a "manager" role with the upcoming RBAC rework'}),"\n",(0,a.jsx)(n.li,{children:'the "manager" role is intended to grant managing capabilities bound to the scope it is assigned for, e.g. projects; it would make sense to also integrate the Domain Manager approach here'}),"\n",(0,a.jsx)(n.li,{children:'during the process of contributing the Domain Manager functionality upstream we were asked to use the already defined "manager" role instead of introducing a new role; so the rename would then also be in line with the upstream contribution'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Links / Comments / References:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/SovereignCloudStack/minutes/blob/main/iaas/20240313.md#domain-manager-rolepersona-markus-hentsch",children:"Team IaaS meeting protocol entry"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://review.opendev.org/c/openstack/keystone-specs/+/903172/2/specs/keystone/2023.1/domain-manager-role.rst#20",children:'request from upstream to re-use existing "manager" role'})}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"allow-flexibility-for-the-roles-a-domain-manager-can-assignrevoke-within-domain",children:"Allow flexibility for the roles a Domain Manager can assign/revoke within domain"}),"\n",(0,a.jsx)(n.p,{children:"Decision Date: 2023-09-27"}),"\n",(0,a.jsx)(n.p,{children:"Decision Maker: Team IaaS, Team IAM"}),"\n",(0,a.jsx)(n.p,{children:"Decision:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:'the standard should not strictly limit the roles a Domain Manager can assign/revoke to/from other users within a domain to the "member" role'}),"\n",(0,a.jsx)(n.li,{children:"the standard should allow CSPs to define one or more roles for Domain Managers to manage"}),"\n",(0,a.jsx)(n.li,{children:"whether or not this includes the Domain Manager role itself is not to be predefined by the standard and should be up to the CSP to decide instead"}),"\n",(0,a.jsx)(n.li,{children:'the standard should only strictly prohibit adding the "admin" role to the list of roles manageable by Domain Managers'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Rationale:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"the available and configured roles might differ between CSPs and infrastructures"}),"\n",(0,a.jsx)(n.li,{children:"the Domain Manager standard should be flexible enough to adapt to different environments while still offering the intended functionality"}),"\n",(0,a.jsx)(n.li,{children:"there might be a tradeoff between self-service flexibility desired by customers and the security regulation a CSP wants to impose, thus allowing or prohibiting the designation of Domain Managers by customers themselves should be up to the CSP to decide"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Links / Comments / References:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://input.scs.community/2023-scs-team-iaas?view#Domain-Manager-Standard-markus-hentsch",children:"Team IaaS meeting protocol entry"})}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"extend-domain-management-functionality-to-keystone-groups",children:"Extend domain management functionality to Keystone groups"}),"\n",(0,a.jsx)(n.p,{children:"Decision Date: 2023-08-04"}),"\n",(0,a.jsx)(n.p,{children:"Decision Maker: SIG IAM"}),"\n",(0,a.jsx)(n.p,{children:"Decision:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"the Domain Manager Standard configuration should cover the groups functionality of Keystone, allowing domain manager to manage groups in domains"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Rationale:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"the groups functionality is a desired IAM feature for customers"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Links / Comments / References:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://input.scs.community/2023-scs-sig-iam#Domain-Admin-rights-for-SCS-IaaS-Customers-184",children:"SIG IAM meeting protocol entry"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/SovereignCloudStack/issues/issues/383",children:"action item issue"})}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"change-the-naming-of-the-domain-manager-role",children:"Change the naming of the Domain Manager role"}),"\n",(0,a.jsx)(n.p,{children:"Decision Date: 2023-08-04"}),"\n",(0,a.jsx)(n.p,{children:"Decision Maker: SIG IAM"}),"\n",(0,a.jsx)(n.p,{children:"Decision:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:'the Domain Manager role should be named "domain-manager" not "domain-admin".'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Rationale:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["avoid confusion with the unscoped admin role and to be inline with the upstream plan: ",(0,a.jsx)(n.a,{href:"https://specs.openstack.org/openstack/keystone-specs/specs/keystone/2023.1/default-service-role.html",children:"Default Service Role - Identity Specs"})]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Links / Comments / References:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://input.scs.community/2023-scs-sig-iam#Domain-Admin-rights-for-SCS-IaaS-Customers-184",children:"SIG IAM meeting protocol entry"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/SovereignCloudStack/issues/issues/184#issuecomment-1670985934",children:"issue comment about decision"})}),"\n"]}),"\n","\n",(0,a.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,a.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{id:"user-content-fn-1",children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://static.opendev.org/docs/patrole/latest/rbac-overview.html",children:"OpenStack Documentation: Role-Based Access Control Overview"})," ",(0,a.jsx)(n.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{id:"user-content-fn-2",children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://bugs.launchpad.net/keystone/+bug/968696",children:'Launchpad bug: "admin"-ness not properly scoped'})," ",(0,a.jsx)(n.a,{href:"#user-content-fnref-2","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{id:"user-content-fn-3",children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://docs.openstack.org/keystone/latest/contributor/services.html#domain-scope",children:"OpenStack Documentation: Keystone for Other Services - Domain Scope"})," ",(0,a.jsx)(n.a,{href:"#user-content-fnref-3","data-footnote-backref":"","aria-label":"Back to reference 3",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{id:"user-content-fn-4",children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://docs.openstack.org/oslo.policy/latest/admin/index.html",children:"OpenStack Documentation: Administering Applications that use oslo.policy"})," ",(0,a.jsx)(n.a,{href:"#user-content-fnref-4","data-footnote-backref":"","aria-label":"Back to reference 4",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{id:"user-content-fn-5",children:["\n",(0,a.jsxs)(n.p,{children:["see the ",(0,a.jsx)(n.a,{href:"https://bugs.launchpad.net/keystone/+bug/2041611",children:"corresponding Launchpad bug at Keystone"})," ",(0,a.jsx)(n.a,{href:"#user-content-fnref-5","data-footnote-backref":"","aria-label":"Back to reference 5",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{id:"user-content-fn-6",children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://governance.openstack.org/tc/goals/selected/consistent-and-secure-rbac.html",children:"OpenStack Technical Committee Governance Documents: Consistent and Secure Default RBAC"})," ",(0,a.jsx)(n.a,{href:"#user-content-fnref-6","data-footnote-backref":"","aria-label":"Back to reference 6",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>t});var a=i(96540);const r={},o=a.createContext(r);function s(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);