"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5054],{8905:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>c,metadata:()=>r,toc:()=>i});var o=s(74848),n=s(28453);const c={},l="Developer Guide",r={id:"container/components/cluster-stacks/components/cluster-stack-provider-openstack/docs/develop",title:"Developer Guide",description:"Developing Cluster Stack Provider OpenStack operator is quite straightforward. First, you need to install some basic prerequisites:",source:"@site/docs/03-container/components/cluster-stacks/components/cluster-stack-provider-openstack/docs/develop.md",sourceDirName:"03-container/components/cluster-stacks/components/cluster-stack-provider-openstack/docs",slug:"/container/components/cluster-stacks/components/cluster-stack-provider-openstack/docs/develop",permalink:"/docs/container/components/cluster-stacks/components/cluster-stack-provider-openstack/docs/develop",draft:!1,unlisted:!1,editUrl:"https://github.com/SovereignCloudStack/docs/tree/main/docs/03-container/components/cluster-stacks/components/cluster-stack-provider-openstack/docs/develop.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Controllers",permalink:"/docs/container/components/cluster-stacks/components/cluster-stack-provider-openstack/docs/controllers"},next:{title:"Container Registry",permalink:"/docs/category/container-registry"}},a={},i=[{value:"Setting Tilt up",id:"setting-tilt-up",level:2},{value:"Developing with Tilt",id:"developing-with-tilt",level:2},{value:"Applying ClusterStack",id:"applying-clusterstack",level:3},{value:"Creating workload cluster",id:"creating-workload-cluster",level:3},{value:"Toggle between local_mode and remote mode",id:"toggle-between-local_mode-and-remote-mode",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"developer-guide",children:"Developer Guide"}),"\n",(0,o.jsx)(t.p,{children:"Developing Cluster Stack Provider OpenStack operator is quite straightforward. First, you need to install some basic prerequisites:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Docker"}),"\n",(0,o.jsx)(t.li,{children:"Go"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Next, configure your environment variables. Once that's done, you can initiate development using the local Kind cluster and the Tilt UI to create a workload cluster that comes pre-configured."}),"\n",(0,o.jsx)(t.h2,{id:"setting-tilt-up",children:"Setting Tilt up"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Install Docker and Go. We expect you to run on a Linux OS."}),"\n",(0,o.jsxs)(t.li,{children:["Create an ",(0,o.jsx)(t.code,{children:".envrc"})," file and specify the values you need. See the ",(0,o.jsx)(t.code,{children:".envrc.sample"})," for details."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"developing-with-tilt",children:"Developing with Tilt"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"tilt",src:s(8860).A+"",title:"Tilt",width:"1848",height:"902"})}),"\n",(0,o.jsx)(t.p,{children:"Operator development requires a lot of iteration, and the \u201cbuild, tag, push, update deployment\u201d workflow can be very tedious. Tilt makes this process much simpler by watching for updates and automatically building and deploying them. To build a kind cluster and to start Tilt, run:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"make tilt-up\n"})}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["To access the Tilt UI please go to: ",(0,o.jsx)(t.code,{children:"http://localhost:10351"})]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"You should make sure that everything in the UI looks green. If not, you can trigger the Tilt workflow again."}),"\n",(0,o.jsx)(t.h3,{id:"applying-clusterstack",children:"Applying ClusterStack"}),"\n",(0,o.jsxs)(t.p,{children:["When you start your tilt setup then the ClusterStack manifest gets copied from ",(0,o.jsx)(t.code,{children:"config/cspo"})," directory to root of your repository. In order to apply the ClusterStack to the running local development cluster, you can click on the tilt UI. There should a click on the top-right hand side that is named as ",(0,o.jsx)(t.code,{children:"apply-clusterstack"})," if you hover over it.\nOnce the ClusterStack is applied wait for the ClusterStack and ClusterStackRelease object to be ready. In case your ClusterStack shows that it is ready, you can deploy a workload cluster."]}),"\n",(0,o.jsx)(t.h3,{id:"creating-workload-cluster",children:"Creating workload cluster"}),"\n",(0,o.jsxs)(t.p,{children:["This could be done through the Tilt UI, by pressing the button in the top right corner ",(0,o.jsx)(t.code,{children:"Create Workload Cluster"}),". This triggers the ",(0,o.jsx)(t.code,{children:"make create-workload-cluster-openstack"}),", which uses the environment variables and the cluster-template."]}),"\n",(0,o.jsx)(t.p,{children:"To interact with your freshly created workload cluster, you can use these commands:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:'make get-kubeconfig-workload-cluster #KUBECONFIG for the workload cluster is placed here: ".workload-cluster-kubeconfig.yaml"\nexport KUBECONFIG=$PWD/.workload-cluster-kubeconfig.yaml\n'})}),"\n",(0,o.jsx)(t.p,{children:"In case you want to change some code, you can do so and see that Tilt triggers on save. It will update the container of the operator automatically."}),"\n",(0,o.jsxs)(t.p,{children:["If you want to change something in your ClusterStack or Cluster custom resources, you can have a look at ",(0,o.jsx)(t.code,{children:".cluster.yaml"})," and ",(0,o.jsx)(t.code,{children:".clusterstack.yaml"}),", which Tilt uses."]}),"\n",(0,o.jsxs)(t.p,{children:["To delete the ClusterStack you can click on the ",(0,o.jsx)(t.code,{children:"delete-clusterstack"})," button in the tilt UI."]}),"\n",(0,o.jsxs)(t.p,{children:["To tear down the workload cluster, click on the ",(0,o.jsx)(t.code,{children:"Delete Workload Cluster"})," button in the top right corner of the Tilt UI. This action triggers the execution of ",(0,o.jsx)(t.code,{children:"make delete-workload-cluster-openstack"}),". After a few minutes, the resources should be successfully deleted."]}),"\n",(0,o.jsx)(t.p,{children:"To tear down the kind cluster, use:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"make delete-bootstrap-cluster\n"})}),"\n",(0,o.jsxs)(t.p,{children:["If you have any trouble finding the right command, then you can use ",(0,o.jsx)(t.code,{children:"make help"})," to get a list of all available make targets."]}),"\n",(0,o.jsx)(t.h2,{id:"toggle-between-local_mode-and-remote-mode",children:"Toggle between local_mode and remote mode"}),"\n",(0,o.jsxs)(t.p,{children:["We can retrieve cluster-stacks in two modes. One way is to let the controller fetch it from GitHub which is remote mode and other is we mount the cluster-stacks inside the container at ",(0,o.jsx)(t.code,{children:"/tmp/downloads/cluster-stacks"})," directory."]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["[!NOTE]",(0,o.jsx)(t.br,{}),"\n","Using remote mode is the default behavior."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Switching between both modes is relatively simple if you're using Tilt. There is a file at the root of the repo ",(0,o.jsx)(t.code,{children:"tilt-settings.yaml.example"}),"\nMake a copy of that file with the name of ",(0,o.jsx)(t.code,{children:"tilt-settings.yaml"})]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"cp tilt-settings.yaml.example tilt-settings.yaml\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Now, open the file and set the ",(0,o.jsx)(t.code,{children:"local_mode"})," to ",(0,o.jsx)(t.code,{children:"true"})," to use cluster-stacks in local_mode. It should look the following content wise."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",children:"local_mode: true\n"})}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsx)(t.p,{children:"[!NOTE]\nIn this mode you need to have cluster-stacks present locally."}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Downloading cluster-stacks can be achieved by many ways but below is a simple way to download it quickly."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"mkdir -p .release/openstack-scs-1-27-v1/\ncd .release/openstack-scs-1-27-v1\ngh release download --repo SovereignCloudStack/cluster-stacks openstack-scs-1-27-v1\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Change the repo and tag as per the requirement. You can also download it directly from browser and move it to ",(0,o.jsx)(t.code,{children:".release"})," directory."]}),"\n",(0,o.jsxs)(t.p,{children:["Please make sure the directory structure remains the same otherwise you'll not be able to start the tilt setup. Here's an example of structuring ",(0,o.jsx)(t.code,{children:"openstack-scs-1-27-v1"})," cluster-stack."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"$ tree .release/openstack-scs-1-27-v1/\n.release/openstack-scs-1-27-v1/\n\u251c\u2500\u2500 clusterstack.yaml\n\u251c\u2500\u2500 metadata.yaml\n\u2514\u2500\u2500 openstack-scs-1-27-cluster-class-v1.tgz\n"})}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["[!IMPORTANT]\nThere's an alternative way to get clusterstacks using ",(0,o.jsx)(t.a,{href:"https://github.com/SovereignCloudStack/csctl",children:"csctl"}),". You can follow the README of csctl for specific instructions and a good quickstart."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["You can use ",(0,o.jsx)(t.code,{children:"csctl create"})," subcommand to create clusterstack locally. You'll need a csctl.yaml file in the cluster-stack configuration directory. Please read more about creating configuration file for csctl in the csctl docs."]})]})}function u(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8860:(e,t,s)=>{s.d(t,{A:()=>o});const o=s.p+"assets/images/tilt-4af6fa61d9a6a82abdfa1c82985f182e.png"},28453:(e,t,s)=>{s.d(t,{R:()=>l,x:()=>r});var o=s(96540);const n={},c=o.createContext(n);function l(e){const t=o.useContext(c);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),o.createElement(c.Provider,{value:t},e.children)}}}]);